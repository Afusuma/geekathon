# Story 1.3: Functional UI Implementation

## Status
Draft

## Story
**As a** hackathon judge,
**I want** a functional interface to input data for the generator, including clear loading and error states, and view the results,
**so that** I can interact with and validate the application's core feature.

## Acceptance Criteria
1. **AC1**: A clean input form is implemented for product data entry with proper validation
2. **AC2**: The form integrates with the `/generate` API endpoint using TanStack Query
3. **AC3**: Loading states are displayed during AI generation with "AI Generation Trace" animation
4. **AC4**: Generated label results are displayed in a clear, readable format
5. **AC5**: Error handling displays user-friendly messages for API failures and validation errors
6. **AC6**: The interface implements the "Input -> Generate -> Review -> Iterate" workflow
7. **AC7**: Basic responsive design works on desktop and mobile devices
8. **AC8**: The UI uses shadcn/ui components and Tailwind CSS for consistent styling

## Tasks / Subtasks

- [ ] **Task 1: Set Up Frontend Infrastructure** (AC: 7, 8)
  - [ ] Configure shadcn/ui component library in Next.js app
  - [ ] Set up Tailwind CSS with custom theme configuration
  - [ ] Install and configure React Hook Form for form management
  - [ ] Install and configure TanStack Query for API integration
  - [ ] Create basic app layout with navigation and footer
  - [ ] Set up responsive design breakpoints

- [ ] **Task 2: Design and Implement Product Input Form** (AC: 1, 6)
  - [ ] Create `ProductInputForm` component using React Hook Form
  - [ ] Implement form fields for product data (name, ingredients, nutrition, etc.)
  - [ ] Add form validation using Zod schemas from shared package
  - [ ] Style form using shadcn/ui form components
  - [ ] Add form submission handling with proper error states
  - [ ] Implement form reset functionality for iteration workflow

- [ ] **Task 3: API Integration with TanStack Query** (AC: 2, 5)
  - [ ] Create API client for `/generate` endpoint
  - [ ] Implement TanStack Query mutation for label generation
  - [ ] Configure API error handling and retry logic
  - [ ] Add proper TypeScript types for API requests/responses
  - [ ] Implement optimistic updates for better UX
  - [ ] Add query invalidation and caching strategies

- [ ] **Task 4: Loading States and AI Generation Trace** (AC: 3)
  - [ ] Create `LoadingSpinner` component with AI generation animation
  - [ ] Implement "AI Generation Trace" animation showing steps
  - [ ] Add progress indicators for different generation phases
  - [ ] Create loading overlay for form during generation
  - [ ] Add estimated time remaining display
  - [ ] Implement cancellation functionality for long requests

- [ ] **Task 5: Label Results Display** (AC: 4, 6)
  - [ ] Create `LabelDisplay` component for generated results
  - [ ] Format nutrition information in readable table layout
  - [ ] Display legal label information with proper formatting
  - [ ] Show marketing information and compliance notes
  - [ ] Add copy-to-clipboard functionality for label text
  - [ ] Implement print-friendly styling for label output

- [ ] **Task 6: Error Handling and User Experience** (AC: 5)
  - [ ] Create `ErrorBoundary` component for React error handling
  - [ ] Implement user-friendly error messages for API failures
  - [ ] Add validation error displays for form fields
  - [ ] Create fallback UI for when generation fails
  - [ ] Add retry mechanisms for failed requests
  - [ ] Implement toast notifications for success/error states

- [ ] **Task 7: Workflow Integration and Polish** (AC: 6, 7)
  - [ ] Implement complete "Input -> Generate -> Review -> Iterate" flow
  - [ ] Add "Generate New Label" functionality to restart workflow
  - [ ] Create responsive layout that works on mobile devices
  - [ ] Add keyboard navigation and accessibility features
  - [ ] Implement proper focus management throughout workflow
  - [ ] Add semantic HTML and ARIA labels for screen readers

- [ ] **Task 8: Testing and Quality Assurance** (AC: All)
  - [ ] Unit tests for all React components
  - [ ] Integration tests for form submission and API calls
  - [ ] User interaction tests with React Testing Library
  - [ ] Accessibility testing with axe-core
  - [ ] Responsive design testing across breakpoints
  - [ ] Error scenario testing and edge cases

## Dev Notes

### Previous Story Insights
**Steel Thread (Story 1.1)** established the monorepo and basic connectivity.
**Core AI Engine (Story 1.2)** implemented the `/generate` API endpoint with complete data models.
This story connects the frontend to the backend to complete the MVP.

### UI Design Goals
[Source: docs/prd/product-requirements-document-smartlabel-ai.md#user-interface-design-goals]

**Primary Workflow**: "Input -> Generate -> Review -> Iterate"
- Clean, fast, and trustworthy tool design
- Focus on core functionality for Epic 1 (single EU market)
- **Note**: Side-by-side comparison is deferred to Epic 2
- **Note**: Compliance Scorecard is deferred to Epic 2

**Key Design Elements for Epic 1**:
- Clean input form for product data
- "AI Generation Trace" animation during processing
- Clear display of generated label results
- Graceful error handling with user-friendly messages

### Tech Stack Requirements
[Source: architecture/tech-stack.md]
- **Frontend Framework**: Next.js (14.x) - React framework
- **UI Component Library**: shadcn/ui (Latest) - Accessible components
- **Styling**: Tailwind CSS (3.x) - Utility-first CSS
- **State Management**: TanStack Query (v5) - Server state management
- **Form Management**: React Hook Form (Latest) - Form state management
- **Frontend Language**: TypeScript (5.x) - Type safety

### Data Models Integration
[Source: Story 1.2 and packages/shared]
- Import `Label`, `LabelData`, `LegalLabel` interfaces from `@smartlabel/shared`
- Use Zod schemas for form validation
- Properly type API requests and responses

### File Locations
[Source: architecture/source-tree.md]
- **Main Page**: `apps/web/src/app/page.tsx`
- **Components**: `apps/web/src/components/`
- **API Client**: `apps/web/src/lib/api.ts`
- **Types**: Import from `@smartlabel/shared`
- **Styles**: `apps/web/src/app/globals.css` for Tailwind

### Component Architecture
**Key Components to Create**:
- `ProductInputForm` - Main form for product data input
- `LabelDisplay` - Display generated label results
- `LoadingSpinner` - AI generation animation
- `ErrorBoundary` - React error handling
- `Layout` - App layout with navigation

### API Integration Pattern
[Source: architecture/coding-standards.md]
```typescript
// Example API integration with TanStack Query
const generateLabel = useMutation({
  mutationFn: async (productData: ProductInput) => {
    const response = await fetch('/api/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(productData)
    });
    if (!response.ok) throw new Error('Generation failed');
    return response.json();
  },
  onSuccess: (data) => {
    // Handle successful generation
  },
  onError: (error) => {
    // Handle generation errors
  }
});
```

### Responsive Design Requirements
- **Desktop**: Full-width form and results side-by-side (optional)
- **Mobile**: Stacked layout with form first, then results
- **Breakpoints**: Use Tailwind CSS responsive utilities
- **Touch-friendly**: Ensure buttons and inputs work well on touch devices

### Accessibility Requirements
- **Keyboard Navigation**: All interactive elements accessible via keyboard
- **Screen Readers**: Proper ARIA labels and semantic HTML
- **Color Contrast**: Meet WCAG 2.1 AA standards
- **Focus Management**: Clear focus indicators and logical tab order

### Error Handling Strategy
- **Network Errors**: Retry with exponential backoff
- **Validation Errors**: Display field-specific error messages
- **API Errors**: User-friendly error messages, not technical details
- **Timeouts**: Show timeout message with retry option
- **Fallbacks**: Graceful degradation for failed API calls

### Performance Considerations
- **Code Splitting**: Use Next.js dynamic imports for large components
- **Image Optimization**: Use Next.js Image component
- **Bundle Size**: Monitor and optimize component imports
- **Loading States**: Prevent layout shift during data loading

## Testing

### Testing Standards
[Source: architecture/tech-stack.md]
- **Frontend Testing**: Jest & React Testing Library (Latest)
- **Component Tests**: Test component behavior and user interactions
- **Integration Tests**: Test API integration and data flow
- **Accessibility Tests**: Use @axe-core/react for a11y testing

### Test Requirements for This Story
- **Component Tests**:
  - ProductInputForm validation and submission
  - LabelDisplay rendering with different data
  - LoadingSpinner animation states
  - ErrorBoundary error handling
- **Integration Tests**:
  - Complete form submission flow
  - API error handling scenarios
  - TanStack Query caching behavior
- **User Interaction Tests**:
  - Complete workflow from input to results
  - Error recovery scenarios
  - Responsive behavior testing

### Test File Locations
- **Component Tests**: `apps/web/src/components/__tests__/`
- **Page Tests**: `apps/web/src/app/__tests__/`
- **Integration Tests**: `apps/web/src/__tests__/integration/`
- **Test Utilities**: `apps/web/src/__tests__/utils/`

### Mocking Strategy
- **API Calls**: Mock `/generate` endpoint responses
- **TanStack Query**: Use testing utilities for query mocking
- **Form Validation**: Test both valid and invalid form states
- **Error Scenarios**: Mock various API failure conditions

## Change Log

| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| Sep 17, 2025 | 1.0 | Initial story draft for Functional UI Implementation | Bob, SM |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*TBD by dev agent*

### Debug Log References
*TBD by dev agent*

### Completion Notes List
*TBD by dev agent*

### File List
*TBD by dev agent*

## QA Results
*Results from QA Agent review will be added here after story completion*